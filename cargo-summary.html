<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Cargo Summary Report (TXT Style)</title>
  <style>
    body {
      font-family: monospace;
      background: #f4f6f8;
      padding: 30px;
    }
    #report {
      white-space: pre;
      background: white;
      padding: 20px;
      border: 1px solid #ccc;
    }
    button {
      margin: 10px 5px;
      padding: 6px 12px;
      border: none;
      border-radius: 4px;
      background: #1976d2;
      color: white;
      cursor: pointer;
    }
    @media print {
      button {
        display: none;
      }
      body {
        background: white;
      }
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body>

  <button onclick="window.print()">üñ®Ô∏è Print</button>
  <button onclick="savePDF()">üíæ Save as PDF</button>
  <button onclick="exportTXT()">üìÑ Export TXT</button>

  <pre id="report"></pre>

  <script>
    // Mock flight + ULD data
    const flightInfo = {
      flightNo: 'QZ 253',
      from: 'DMK',
      to: 'CGK',
      date: '25/07/2025',
      std: '00:20:40',
    };

    const uldData = [
      {
        uldNo: "BC-148",
        mawb: "900-1131 3831",
        quantity: 36,
        grossWeight: 274.00,
        destination: "CGK",
        shc: "VAL"
      },
      {
        uldNo: "BC-168",
        mawb: "900-1131 4444",
        quantity: 40,
        grossWeight: 300.00,
        destination: "CGK",
        shc: "PER"
      }
    ];

    function formatLine(text, width) {
      return text.toString().padEnd(width, ' ');
    }

    function renderReportText() {
      let report = '';

      report += formatLine(`${flightInfo.flightNo}`, 16) + formatLine(`${flightInfo.from}`, 8) + `${flightInfo.to}\n`;
      report += formatLine(`${flightInfo.date} ${flightInfo.std}`, 24) + `${flightInfo.date} ${flightInfo.std}\n\n`;

      report += formatLine('MawbNo', 20)
              + formatLine('Quantity', 10)
              + formatLine('GrossWeigh', 12)
              + formatLine('DestPortShipmen', 18)
              + formatLine('Get Weight', 12)
              + 'SHC\n\n';

      let totalULD = 0;
      let totalPCS = 0;
      let totalWeight = 0;

      uldData.forEach(uld => {
        report += `ULD NO ${uld.uldNo}\n`;
        report += '  ' +
          formatLine(uld.mawb, 18) +
          formatLine(uld.quantity, 10) +
          formatLine(uld.grossWeight.toFixed(2), 12) +
          formatLine(uld.destination, 18) +
          formatLine('0.00', 12) +
          uld.shc + '\n\n';

        totalULD++;
        totalPCS += uld.quantity;
        totalWeight += uld.grossWeight;
      });

      report += `TOTAL ULD : ${totalULD}`.padEnd(24)
              + formatLine(totalPCS, 10)
              + formatLine(totalWeight.toFixed(2), 12)
              + formatLine('', 18)
              + formatLine('0.00', 12);

      document.getElementById('report').textContent = report;
    }

    function savePDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      const text = document.getElementById("report").textContent;
      doc.setFont("Courier", "normal");
      doc.setFontSize(10);
      doc.text(text, 10, 10);
      doc.save(`Cargo_Summary_${flightInfo.flightNo}.pdf`);
    }

    function exportTXT() {
      const text = document.getElementById("report").textContent;
      const blob = new Blob([text], { type: "text/plain;charset=utf-8" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = `Cargo_Summary_${flightInfo.flightNo}.txt`;
      link.click();
    }

    renderReportText();
  </script>
</body>
</html>
